<html>
    <head>
        <title>Mars Clock by James Tauber</title>
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,700,300,400" rel="stylesheet" type="text/css">

        <style>
            body {
                font-family: "Open Sans", sans-serif;
                font-weight: 300;
                color: #222;
            }
            h1, h2 {
                margin: 1.5em 0 0;
                font-weight: 700;
            }
            h1 span, h2 span {
                font-weight: 300;
                color: #666;
                font-size: 70%;
            }
             .container {
                width: 960px;
                margin: 50px auto;
                text-align: center;
            }
            .clock {
                background: #F7F7F7;
                width: 240px;
                margin: 10px auto;
                padding: 5px 10px;
            }
            .clock h3 {
                margin: 0;
                font-weight: 300;
                
            }
            .clock .time {
                font-size: 200%;
                
            }
            .clear {
                clear: both;
            }
            .credits {
                font-weight: 400;
                margin-top: 50px;
                font-size: 8pt;
                
            }
            a {
                color: #222;
            }
            .column {
                float: left;
                width: 480px;
            }
            .explanation-link {
                cursor: pointer;
            }
        </style>
    </head>
    
    <body>
        <div class="container">
            <h1>Mars Clock <span>by James Tauber</span></h1>
            
            <p>This is a live calculation of the time on Mars, both Coordinated Time (think UTC but for Mars) and at the Curiosity site. I plan to further elaborate on these calculations but wanted to get something up quickly.</p>
            <div style="margin-bottom: 50px;">
                <a href="https://twitter.com/share" class="twitter-share-button" data-via="jtauber" data-related="jtauber">Tweet</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                <a href="https://twitter.com/jtauber" class="twitter-follow-button" data-show-count="true">Follow @jtauber</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                <iframe style="border: 0; margin: 0; padding: 0;"
                    src="https://www.gittip.com/jtauber/widget.html" 
                    width="48pt" height="20pt"></iframe>
            </div>
            
            <div class="column">
                <h2>Earth</h2>
                
                <div>
                    <span class="utc-time"></span>
                    <div class="explanation-link" data-explanation="#millis-explanation">
                        <i>millis</i> = <span class="millis"></span>
                    </div>
                    <div class="explanation-link" data-explanation="#jd_ut-explanation">
                        JD<sub>UT</sub> = <span class="jd_ut"></span>
                    </div>
                    <div class="explanation-link" data-explanation="#jd_tt-explanation">
                        JD<sub>TT</sub> = <span class="jd_tt"></span>
                    </div>
                </div>
                
                <div class="clock explanation-link" data-explanation="#j2000-explanation">
                    <h3>Days Since J2000 Epoch</h3>
                    <span class="time j2000"></span>
                </div>
                
                <h2>Mars</h2>
                
                <div>
                    <div class="explanation-link" data-explanation="#m-explanation">
                        M = <span class="m"></span>&deg;
                    </div>
                    <div class="explanation-link" data-explanation="#alpha_fms-explanation">
                        &alpha;<sub>FMS</sub> = <span class="alpha_fms"></span>&deg;
                    </div>
                    PBS = <span class="pbs"></span>&deg;
                    <div class="explanation-link" data-explanation="#v_m-explanation">
                        v - M = <span class="v_m"></span>&deg;
                    </div>
                    L<sub>s</sub> = <span class="l_s"></span>&deg;<br>
                    EOT = <span class="eot"></span>&deg; = <span class="eot_h"></span>h
                </div>
                
                <div class="clock">
                    <h3>Coordinated Mars Time</h3>
                    <div class="time mtc"></div>
                </div>
                
                <h2>Curiosity<br><span>137.4&deg;E longitude</span></h2>
                
                <div class="clock">
                    <h3>Local Mean Solar Time</h3>
                    <div class="time lmst"></div>
                </div>
                
                <div class="clock">
                    <h3>Local True Solar Time</h3>
                    <div class="time ltst"></div>
                </div>
            </div>
            
            <div class="column">
                <p class="help">Mouse over a number on the left to get an explanation below<br>(in progress)</p>
                <div class="explanation" id="millis-explanation">
                    <div class="clock">
                        <h3>Milliseconds since<br>Unix Epoch</h3>
                        <span class="time millis"></span>
                    </div>
                    <p>This is the number of milliseconds since<br>1 January 1970 00:00:00 UTC.</p>
                    <p>We get this straight from your browser.</p>
                </div>
                <div class="explanation" id="jd_ut-explanation">
                    <div class="clock">
                        <h3>Julian Date (UT)</h3>
                        <span class="time jd_ut"></span>
                    </div>
                    <p>This is the number of days (rather than milliseconds) since a much older epoch than Unix time.</p>
                    <p>
                        Rather than an elaborate conversion from the Gregorian date to the Julian date, we just divide
                        <i>millis</i> by 86,400,000 to get the number of days since the Unix epoch and add that number
                        to 2440587.5, the Julian Date at the Unix epoch.
                    </p>
                    <p>JD<sub>UT</sub> = 2440587.5 + (<i>millis</i> / 8.64 &times; 10<sup>7</sup> ms/day)</p>
                </div>
                <div class="explanation" id="jd_tt-explanation">
                    <div class="clock">
                        <h3>Julian Date (TT)</h3>
                        <span class="time jd_ut"></span>
                    </div>
                    <p>
                        We actually need the Terrestrial Time (TT) Julian Date rather than the UTC-based one.
                        This means we basically just add the leap seconds which, since 1 July 2012 are 35 + 32.184.
                    </p>
                    <p>JD<sub>TT</sub> = JD<sub>UT</sub> + (35 + 32.184) / 86400</p>
                </div>
                <div class="explanation" id="j2000-explanation">
                    <div class="clock">
                        <h3>Days Since J2000 Epoch</h3>
                        <span class="time j2000"></span>
                    </div>
                    <p>
                        This is the number we're going to use as the input to our Mars calculations.
                        It's the number of (fractional) days since<br>12:00 on 1 January 2000<br>in Terrestrial Time.
                    </p>
                    <p>
                        We know what JD<sub>TT</sub> was at the J2000 epoch (2451545.0) so it's trivial to convert.
                    </p>
                    <p>
                        &Delta;t<sub>J2000</sub> = JD<sub>TT</sub> - 2451545.0
                    </p>
                </div>
                <div class="explanation" id="m-explanation">
                    <div class="clock">
                        <h3>Mars Mean Anomaly</h3>
                        <span class="time"><span class="m"></span>&deg;</span>
                    </div>
                    <p>
                        The mean anomaly is a measure of where an orbiting body is in its orbit. More precisely,
                        it's a measure of how far into the full orbit the body is since its last periapsis (the point
                        in the ellipse closest to the focus).
                    </p>
                    <p>
                        The mean anomaly is the ratio into the full orbit, multiplied by 2&pi; (radians) or 360&deg; although the value doesn't truly correspond to any angle. The mean anomaly is proportional to time (and
                        hence area swept) rather that the actual angle of the body from the
                        focus (which would be the <i>true anomaly</i>).
                    </p>
                    <p>
                        So the mean anomaly can be calculated from &Delta;t<sub>J2000</sub> if we know the mean
                        anomaly at the J2000 epoch (19.3870&deg;) and the mean daily motion (360&deg; / length of anomalistic orbit in days).
                    </p>
                    <p>
                        This gives us:
                    </p>
                    <p>
                        M = 19.3870&deg; + 0.52402075&deg;&Delta;t<sub>J2000</sub>
                    </p>
                    <p>
                        for Mars.
                    </p>
                </div>
                <div class="explanation" id="alpha_fms-explanation">
                    <div class="clock">
                        <h3>Angle of Fictitious Mean Sun</h3>
                        <span class="time"><span class="alpha_fms"></span>&deg;</span>
                    </div>
                    <p>
                        Mars goes around the Sun, but viewed from Mars's point of view, the Sun goes around Mars.
                        I'm not talking about the daily motion of the Sun caused by Mars's rotation, but the year-long
                        motion of the Sun viewed from Mars.
                    </p>
                    <p>
                        Because the orbit is an ellipse, the Sun will go faster some times than others. Imagine a
                        fictitious Sun, though, that took the same Martian year to go around Mars but which orbited at a 
                        constant angular velocity (the mean of the real Sun). This is the <i>fictitious mean Sun</i>
                        and it's easier to calculate its angle first because, like the mean anomaly, it is proportional
                        to time.
                    </p>
                    <p>
                        Based on observations, Allison and McEwen give the angle at J2000 and the daily change (based on
                        tropical orbit period) as 270.3863&deg; and 0.52403840&deg; / day respectively.
                    </p>
                    <p>This gives us:
                    <p>
                        &alpha;<sub>FMS</sub> = 270.3863&deg; + 0.52403840&deg;&Delta;t<sub>J2000</sub>
                    </p>
                </div>
                <div class="explanation" id="v_m-explanation">
                    <div class="clock">
                        <h3>Equation of Center</h3>
                        <span class="time"><span class="v_m"></span>&deg;</span>
                    </div>
                    <p>
                        The difference between the actual position of the Sun and the fictitious mean Sun is the same as
                        the difference between the true anomaly and mean anomaly. This is called the <i>Equation of Center</i>.
                    </p>
                    <p>
                        For a two-body Kepler orbit, this difference can be approximated using a Fourier-Bessel series given 
                        the mean anomaly M and eccentricity <i>e</i>.
                    </p>
                    <p>
                        The eccentricity is the deviation of the orbit's ellipse from being a perfect circle. It varies
                        ever so slightly over time and for Mars is given by <i>e</i> = 0.09340 &plus; 2.477 &times 10<sup>-9</sup> / day &Delta;t<sub>J2000</sub> = <span class="e"></span>.
                    </p>
                    <p>Once this is plugged into the Fourier-Bessel series example, the result is:</p>
                    <p>
                        (10.691&deg; &plus; 3&deg; &times 10<sup>-7</sup> &Delta;<i>t</i><sub>J2000</sub>) sin <i>M</i>
                        <br>&plus; 0.623&deg; sin 2<i>M</i>
                        <br>&plus; 0.050&deg; sin 3<i>M</i>
                        <br>&plus; 0.005&deg; sin 4<i>M</i>
                        <br>&plus; 0.0005&deg; sin 5<i>M</i>
                    </p>
                    <p>
                        We're not quite done yet as the above assumes a two-body Kepler motion and we need to include the 
                        perturbations caused by other planets previously calculated.
                    </p>
                    <p>Once they have been added, we have our equation of center.</p>
                </div>
            </div>
            
            <div class="clear"></div>
            <div class="credits">
                Formulae from
                Allison, M., and M. McEwen 2000. <a href="http://pubs.giss.nasa.gov/abs/al05000n.html">A post-Pathfinder evaluation of aerocentric solar coordinates with improved timing recipes for Mars seasonal/diurnal climate studies.</a> <i>Planet. Space Sci.</i> <b>48</b>, 215-235.
                and <a href="http://www.giss.nasa.gov/tools/mars24/help/algorithm.html">Mars24 Algorithm and Worked Examples</a>
            </div>
            
        </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script>
            function cos(deg) {
                return Math.cos(deg * Math.PI / 180);
            }
            function sin(deg) {
                return Math.sin(deg * Math.PI / 180);
            }
            function h_to_hms(h) {
                var x = h * 3600;
                var hh = Math.floor(x / 3600);
                if (hh < 10) hh = "0" + hh;
                var y = x % 3600;
                var mm = Math.floor(y / 60);
                if (mm < 10) mm = "0" + mm;
                var ss = Math.round(y % 60);
                if (ss < 10) ss = "0" + ss;
                return hh + ":" + mm + ":" + ss;
            }
            function update() {
                var d = new Date();
                $(".utc-time").text(d.toUTCString());
                var millis = d.getTime();
                var jd_ut = 2440587.5 + (millis / 8.64E7);
                var jd_tt = jd_ut + (35 + 32.184) / 86400;
                var j2000 = jd_tt - 2451545.0;
                var m = (19.3870 + 0.52402075 * j2000) % 360;
                var alpha_fms = (270.3863 + 0.52403840 * j2000) % 360;
                var e = (0.09340 + 2.477E-9 * j2000);
                var pbs =
                    0.0071 * cos((0.985626 * j2000 /  2.2353) +  49.409) +
                    0.0057 * cos((0.985626 * j2000 /  2.7543) + 168.173) +
                    0.0039 * cos((0.985626 * j2000 /  1.1177) + 191.837) +
                    0.0037 * cos((0.985626 * j2000 / 15.7866) +  21.736) +
                    0.0021 * cos((0.985626 * j2000 /  2.1354) +  15.704) +
                    0.0020 * cos((0.985626 * j2000 /  2.4694) +  95.528) +
                    0.0018 * cos((0.985626 * j2000 / 32.8493) +  49.095);
                var v_m = (10.691 + 3.0E-7 * j2000) * sin(m) +
                    0.623 * sin(2 * m) +
                    0.050 * sin(3 * m) +
                    0.005 * sin(4 * m) +
                    0.0005 * sin(5 * m) +
                    pbs;
                var l_s = (alpha_fms + v_m) % 360;
                var eot = 2.861 * sin(2 * l_s) - 0.071 * sin(4 * l_s) + 0.002 * sin(6 * l_s) - v_m;
                var eot_h = eot * 24 / 360;
                var mtc = (24 * (((jd_tt - 2451549.5) / 1.027491252) + 44796.0 - 0.00096)) % 24;
                
                var lambda = 360 - 137.4;
                
                var lmst = (mtc - lambda * 24 / 360);
                if (lmst < 0) {
                    lmst += 24;
                } else if (lmst >= 24) {
                    lmst -= 24;
                }
                var ltst = (lmst + eot * 24 / 360);
                if (ltst < 0) {
                    ltst += 24;
                } else if (ltst >= 24) {
                    ltst -= 24;
                }
                
                $(".millis").text(millis);
                $(".jd_ut").text(jd_ut.toFixed(5));
                $(".jd_tt").text(jd_tt.toFixed(5));
                $(".j2000").text(j2000.toFixed(5));
                $(".m").text(m.toFixed(5));
                $(".alpha_fms").text(alpha_fms.toFixed(5));
                $(".pbs").text(pbs.toFixed(5));
                $(".e").text(e.toFixed(5));
                $(".v_m").text(v_m.toFixed(5));
                $(".l_s").text(l_s.toFixed(5));
                $(".eot").text(eot.toFixed(5));
                $(".eot_h").text(eot_h.toFixed(5));
                $(".mtc").text(h_to_hms(mtc));
                $(".lmst").text(h_to_hms(lmst));
                $(".ltst").text(h_to_hms(ltst));
            }
            $(function() {
                update();
                $(".explanation").hide();
                setInterval("update()", 10);
                $(".explanation-link").hover(function() {
                    $(".explanation").hide();
                    $(this).css("font-weight", "bold");
                    $(".help").hide();
                    $($(this).data("explanation")).show();
                }, function() {
                    $(this).css("font-weight", "300");
                    $(".help").show();
                    $($(this).data("explanation")).hide();
                });
            });
        </script>
        <script type="text/javascript">
          var _gauges = _gauges || [];
          (function() {
            var t   = document.createElement('script');
            t.type  = 'text/javascript';
            t.async = true;
            t.id    = 'gauges-tracker';
            t.setAttribute('data-site-id', '4f7c4470613f5d112800015d');
            t.src = '//secure.gaug.es/track.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(t, s);
          })();
        </script>
    </body>
</html>
